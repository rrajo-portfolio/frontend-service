import{a as _e}from"./chunk-HBN5ZDUM.js";import{B as Se,Ba as ze,Ca as Je,Ea as $e,d as de,e as He,f as ee,g as je,i as ue,j as we,l as pe,m as Ke,n as Ue,o as Ve,x as xe,y as Ee,z as ye}from"./chunk-XZKYCDIA.js";var Re=de(ge=>{"use strict";ge.byteLength=xr;ge.toByteArray=wr;ge.fromByteArray=vr;var Q=[],$=[],pr=typeof Uint8Array<"u"?Uint8Array:Array,Ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(oe=0,Ye=Ie.length;oe<Ye;++oe)Q[oe]=Ie[oe],$[Ie.charCodeAt(oe)]=oe;var oe,Ye;$[45]=62;$[95]=63;function We(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function xr(t){var e=We(t),r=e[0],n=e[1];return(r+n)*3/4-n}function mr(t,e,r){return(e+r)*3/4-r}function wr(t){var e,r=We(t),n=r[0],i=r[1],a=new pr(mr(t,n,i)),c=0,v=i>0?n-4:n,u;for(u=0;u<v;u+=4)e=$[t.charCodeAt(u)]<<18|$[t.charCodeAt(u+1)]<<12|$[t.charCodeAt(u+2)]<<6|$[t.charCodeAt(u+3)],a[c++]=e>>16&255,a[c++]=e>>8&255,a[c++]=e&255;return i===2&&(e=$[t.charCodeAt(u)]<<2|$[t.charCodeAt(u+1)]>>4,a[c++]=e&255),i===1&&(e=$[t.charCodeAt(u)]<<10|$[t.charCodeAt(u+1)]<<4|$[t.charCodeAt(u+2)]>>2,a[c++]=e>>8&255,a[c++]=e&255),a}function yr(t){return Q[t>>18&63]+Q[t>>12&63]+Q[t>>6&63]+Q[t&63]}function gr(t,e,r){for(var n,i=[],a=e;a<r;a+=3)n=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(t[a+2]&255),i.push(yr(n));return i.join("")}function vr(t){for(var e,r=t.length,n=r%3,i=[],a=16383,c=0,v=r-n;c<v;c+=a)i.push(gr(t,c,c+a>v?v:c+a));return n===1?(e=t[r-1],i.push(Q[e>>2]+Q[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(Q[e>>10]+Q[e>>4&63]+Q[e<<2&63]+"=")),i.join("")}});var Xe=de(()=>{"use strict"});var Ge=de(Te=>{"use strict";Te.read=function(t,e,r,n,i){var a,c,v=i*8-n-1,u=(1<<v)-1,_=u>>1,S=-7,I=r?i-1:0,D=r?-1:1,C=t[e+I];for(I+=D,a=C&(1<<-S)-1,C>>=-S,S+=v;S>0;a=a*256+t[e+I],I+=D,S-=8);for(c=a&(1<<-S)-1,a>>=-S,S+=n;S>0;c=c*256+t[e+I],I+=D,S-=8);if(a===0)a=1-_;else{if(a===u)return c?NaN:(C?-1:1)*(1/0);c=c+Math.pow(2,n),a=a-_}return(C?-1:1)*c*Math.pow(2,a-n)};Te.write=function(t,e,r,n,i,a){var c,v,u,_=a*8-i-1,S=(1<<_)-1,I=S>>1,D=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=n?0:a-1,Y=n?1:-1,ce=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,c=S):(c=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-c))<1&&(c--,u*=2),c+I>=1?e+=D/u:e+=D*Math.pow(2,1-I),e*u>=2&&(c++,u/=2),c+I>=S?(v=0,c=S):c+I>=1?(v=(e*u-1)*Math.pow(2,i),c=c+I):(v=e*Math.pow(2,I-1)*Math.pow(2,i),c=0));i>=8;t[r+C]=v&255,C+=Y,v/=256,i-=8);for(c=c<<i|v,_+=i;_>0;t[r+C]=c&255,C+=Y,c/=256,_-=8);t[r+C-Y]|=ce*128}});var ur=de(le=>{"use strict";var Be=Re(),fe=Ge(),qe=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;le.Buffer=f;le.SlowBuffer=Er;le.INSPECT_MAX_BYTES=50;var ve=2147483647;le.kMaxLength=ve;f.TYPED_ARRAY_SUPPORT=kr();!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function kr(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),t.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}});Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function re(t){if(t>ve)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,f.prototype),e}function f(t,e,r){if(typeof t=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Pe(t)}return er(t,e,r)}f.poolSize=8192;function er(t,e,r){if(typeof t=="string")return Fr(t,e);if(ArrayBuffer.isView(t))return br(t);if(t==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Z(t,ArrayBuffer)||t&&Z(t.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Z(t,SharedArrayBuffer)||t&&Z(t.buffer,SharedArrayBuffer)))return Le(t,e,r);if(typeof t=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(n!=null&&n!==t)return f.from(n,e,r);var i=Ur(t);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof t[Symbol.toPrimitive]=="function")return f.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}f.from=function(t,e,r){return er(t,e,r)};Object.setPrototypeOf(f.prototype,Uint8Array.prototype);Object.setPrototypeOf(f,Uint8Array);function rr(t){if(typeof t!="number")throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function Ar(t,e,r){return rr(t),t<=0?re(t):e!==void 0?typeof r=="string"?re(t).fill(e,r):re(t).fill(e):re(t)}f.alloc=function(t,e,r){return Ar(t,e,r)};function Pe(t){return rr(t),re(t<0?0:Ne(t)|0)}f.allocUnsafe=function(t){return Pe(t)};f.allocUnsafeSlow=function(t){return Pe(t)};function Fr(t,e){if((typeof e!="string"||e==="")&&(e="utf8"),!f.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=tr(t,e)|0,n=re(r),i=n.write(t,e);return i!==r&&(n=n.slice(0,i)),n}function Ce(t){for(var e=t.length<0?0:Ne(t.length)|0,r=re(e),n=0;n<e;n+=1)r[n]=t[n]&255;return r}function br(t){if(Z(t,Uint8Array)){var e=new Uint8Array(t);return Le(e.buffer,e.byteOffset,e.byteLength)}return Ce(t)}function Le(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return e===void 0&&r===void 0?n=new Uint8Array(t):r===void 0?n=new Uint8Array(t,e):n=new Uint8Array(t,e,r),Object.setPrototypeOf(n,f.prototype),n}function Ur(t){if(f.isBuffer(t)){var e=Ne(t.length)|0,r=re(e);return r.length===0||t.copy(r,0,0,e),r}if(t.length!==void 0)return typeof t.length!="number"||De(t.length)?re(0):Ce(t);if(t.type==="Buffer"&&Array.isArray(t.data))return Ce(t.data)}function Ne(t){if(t>=ve)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ve.toString(16)+" bytes");return t|0}function Er(t){return+t!=t&&(t=0),f.alloc(+t)}f.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==f.prototype};f.compare=function(e,r){if(Z(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),Z(r,Uint8Array)&&(r=f.from(r,r.offset,r.byteLength)),!f.isBuffer(e)||!f.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===r)return 0;for(var n=e.length,i=r.length,a=0,c=Math.min(n,i);a<c;++a)if(e[a]!==r[a]){n=e[a],i=r[a];break}return n<i?-1:i<n?1:0};f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};f.concat=function(e,r){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return f.alloc(0);var n;if(r===void 0)for(r=0,n=0;n<e.length;++n)r+=e[n].length;var i=f.allocUnsafe(r),a=0;for(n=0;n<e.length;++n){var c=e[n];if(Z(c,Uint8Array))a+c.length>i.length?f.from(c).copy(i,a):Uint8Array.prototype.set.call(i,c,a);else if(f.isBuffer(c))c.copy(i,a);else throw new TypeError('"list" argument must be an Array of Buffers');a+=c.length}return i};function tr(t,e){if(f.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Z(t,ArrayBuffer))return t.byteLength;if(typeof t!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&r===0)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return Me(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return r*2;case"hex":return r>>>1;case"base64":return cr(t).length;default:if(i)return n?-1:Me(t).length;e=(""+e).toLowerCase(),i=!0}}f.byteLength=tr;function Sr(t,e,r){var n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((r===void 0||r>this.length)&&(r=this.length),r<=0)||(r>>>=0,e>>>=0,r<=e))return"";for(t||(t="utf8");;)switch(t){case"hex":return Nr(this,e,r);case"utf8":case"utf-8":return ir(this,e,r);case"ascii":return Mr(this,e,r);case"latin1":case"binary":return Pr(this,e,r);case"base64":return Cr(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Dr(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}f.prototype._isBuffer=!0;function ae(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}f.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<e;r+=2)ae(this,r,r+1);return this};f.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<e;r+=4)ae(this,r,r+3),ae(this,r+1,r+2);return this};f.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<e;r+=8)ae(this,r,r+7),ae(this,r+1,r+6),ae(this,r+2,r+5),ae(this,r+3,r+4);return this};f.prototype.toString=function(){var e=this.length;return e===0?"":arguments.length===0?ir(this,0,e):Sr.apply(this,arguments)};f.prototype.toLocaleString=f.prototype.toString;f.prototype.equals=function(e){if(!f.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:f.compare(this,e)===0};f.prototype.inspect=function(){var e="",r=le.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"};qe&&(f.prototype[qe]=f.prototype.inspect);f.prototype.compare=function(e,r,n,i,a){if(Z(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),!f.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(r===void 0&&(r=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),a===void 0&&(a=this.length),r<0||n>e.length||i<0||a>this.length)throw new RangeError("out of range index");if(i>=a&&r>=n)return 0;if(i>=a)return-1;if(r>=n)return 1;if(r>>>=0,n>>>=0,i>>>=0,a>>>=0,this===e)return 0;for(var c=a-i,v=n-r,u=Math.min(c,v),_=this.slice(i,a),S=e.slice(r,n),I=0;I<u;++I)if(_[I]!==S[I]){c=_[I],v=S[I];break}return c<v?-1:v<c?1:0};function nr(t,e,r,n,i){if(t.length===0)return-1;if(typeof r=="string"?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,De(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0)if(i)r=0;else return-1;if(typeof e=="string"&&(e=f.from(e,n)),f.isBuffer(e))return e.length===0?-1:Qe(t,e,r,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):Qe(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function Qe(t,e,r,n,i){var a=1,c=t.length,v=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(t.length<2||e.length<2)return-1;a=2,c/=2,v/=2,r/=2}function u(C,Y){return a===1?C[Y]:C.readUInt16BE(Y*a)}var _;if(i){var S=-1;for(_=r;_<c;_++)if(u(t,_)===u(e,S===-1?0:_-S)){if(S===-1&&(S=_),_-S+1===v)return S*a}else S!==-1&&(_-=_-S),S=-1}else for(r+v>c&&(r=c-v),_=r;_>=0;_--){for(var I=!0,D=0;D<v;D++)if(u(t,_+D)!==u(e,D)){I=!1;break}if(I)return _}return-1}f.prototype.includes=function(e,r,n){return this.indexOf(e,r,n)!==-1};f.prototype.indexOf=function(e,r,n){return nr(this,e,r,n,!0)};f.prototype.lastIndexOf=function(e,r,n){return nr(this,e,r,n,!1)};function _r(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var a=e.length;n>a/2&&(n=a/2);for(var c=0;c<n;++c){var v=parseInt(e.substr(c*2,2),16);if(De(v))return c;t[r+c]=v}return c}function Ir(t,e,r,n){return ke(Me(e,t.length-r),t,r,n)}function Rr(t,e,r,n){return ke(jr(e),t,r,n)}function Tr(t,e,r,n){return ke(cr(e),t,r,n)}function Br(t,e,r,n){return ke(Kr(e,t.length-r),t,r,n)}f.prototype.write=function(e,r,n,i){if(r===void 0)i="utf8",n=this.length,r=0;else if(n===void 0&&typeof r=="string")i=r,n=this.length,r=0;else if(isFinite(r))r=r>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var a=this.length-r;if((n===void 0||n>a)&&(n=a),e.length>0&&(n<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var c=!1;;)switch(i){case"hex":return _r(this,e,r,n);case"utf8":case"utf-8":return Ir(this,e,r,n);case"ascii":case"latin1":case"binary":return Rr(this,e,r,n);case"base64":return Tr(this,e,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Br(this,e,r,n);default:if(c)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),c=!0}};f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Cr(t,e,r){return e===0&&r===t.length?Be.fromByteArray(t):Be.fromByteArray(t.slice(e,r))}function ir(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var a=t[i],c=null,v=a>239?4:a>223?3:a>191?2:1;if(i+v<=r){var u,_,S,I;switch(v){case 1:a<128&&(c=a);break;case 2:u=t[i+1],(u&192)===128&&(I=(a&31)<<6|u&63,I>127&&(c=I));break;case 3:u=t[i+1],_=t[i+2],(u&192)===128&&(_&192)===128&&(I=(a&15)<<12|(u&63)<<6|_&63,I>2047&&(I<55296||I>57343)&&(c=I));break;case 4:u=t[i+1],_=t[i+2],S=t[i+3],(u&192)===128&&(_&192)===128&&(S&192)===128&&(I=(a&15)<<18|(u&63)<<12|(_&63)<<6|S&63,I>65535&&I<1114112&&(c=I))}}c===null?(c=65533,v=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|c&1023),n.push(c),i+=v}return Lr(n)}var Ze=4096;function Lr(t){var e=t.length;if(e<=Ze)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=Ze));return r}function Mr(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]&127);return n}function Pr(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function Nr(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=e;a<r;++a)i+=Vr[t[a]];return i}function Dr(t,e,r){for(var n=t.slice(e,r),i="",a=0;a<n.length-1;a+=2)i+=String.fromCharCode(n[a]+n[a+1]*256);return i}f.prototype.slice=function(e,r){var n=this.length;e=~~e,r=r===void 0?n:~~r,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),r<0?(r+=n,r<0&&(r=0)):r>n&&(r=n),r<e&&(r=e);var i=this.subarray(e,r);return Object.setPrototypeOf(i,f.prototype),i};function O(t,e,r){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(e,r,n){e=e>>>0,r=r>>>0,n||O(e,r,this.length);for(var i=this[e],a=1,c=0;++c<r&&(a*=256);)i+=this[e+c]*a;return i};f.prototype.readUintBE=f.prototype.readUIntBE=function(e,r,n){e=e>>>0,r=r>>>0,n||O(e,r,this.length);for(var i=this[e+--r],a=1;r>0&&(a*=256);)i+=this[e+--r]*a;return i};f.prototype.readUint8=f.prototype.readUInt8=function(e,r){return e=e>>>0,r||O(e,1,this.length),this[e]};f.prototype.readUint16LE=f.prototype.readUInt16LE=function(e,r){return e=e>>>0,r||O(e,2,this.length),this[e]|this[e+1]<<8};f.prototype.readUint16BE=f.prototype.readUInt16BE=function(e,r){return e=e>>>0,r||O(e,2,this.length),this[e]<<8|this[e+1]};f.prototype.readUint32LE=f.prototype.readUInt32LE=function(e,r){return e=e>>>0,r||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};f.prototype.readUint32BE=f.prototype.readUInt32BE=function(e,r){return e=e>>>0,r||O(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};f.prototype.readIntLE=function(e,r,n){e=e>>>0,r=r>>>0,n||O(e,r,this.length);for(var i=this[e],a=1,c=0;++c<r&&(a*=256);)i+=this[e+c]*a;return a*=128,i>=a&&(i-=Math.pow(2,8*r)),i};f.prototype.readIntBE=function(e,r,n){e=e>>>0,r=r>>>0,n||O(e,r,this.length);for(var i=r,a=1,c=this[e+--i];i>0&&(a*=256);)c+=this[e+--i]*a;return a*=128,c>=a&&(c-=Math.pow(2,8*r)),c};f.prototype.readInt8=function(e,r){return e=e>>>0,r||O(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};f.prototype.readInt16LE=function(e,r){e=e>>>0,r||O(e,2,this.length);var n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};f.prototype.readInt16BE=function(e,r){e=e>>>0,r||O(e,2,this.length);var n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};f.prototype.readInt32LE=function(e,r){return e=e>>>0,r||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};f.prototype.readInt32BE=function(e,r){return e=e>>>0,r||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};f.prototype.readFloatLE=function(e,r){return e=e>>>0,r||O(e,4,this.length),fe.read(this,e,!0,23,4)};f.prototype.readFloatBE=function(e,r){return e=e>>>0,r||O(e,4,this.length),fe.read(this,e,!1,23,4)};f.prototype.readDoubleLE=function(e,r){return e=e>>>0,r||O(e,8,this.length),fe.read(this,e,!0,52,8)};f.prototype.readDoubleBE=function(e,r){return e=e>>>0,r||O(e,8,this.length),fe.read(this,e,!1,52,8)};function V(t,e,r,n,i,a){if(!f.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<a)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(e,r,n,i){if(e=+e,r=r>>>0,n=n>>>0,!i){var a=Math.pow(2,8*n)-1;V(this,e,r,n,a,0)}var c=1,v=0;for(this[r]=e&255;++v<n&&(c*=256);)this[r+v]=e/c&255;return r+n};f.prototype.writeUintBE=f.prototype.writeUIntBE=function(e,r,n,i){if(e=+e,r=r>>>0,n=n>>>0,!i){var a=Math.pow(2,8*n)-1;V(this,e,r,n,a,0)}var c=n-1,v=1;for(this[r+c]=e&255;--c>=0&&(v*=256);)this[r+c]=e/v&255;return r+n};f.prototype.writeUint8=f.prototype.writeUInt8=function(e,r,n){return e=+e,r=r>>>0,n||V(this,e,r,1,255,0),this[r]=e&255,r+1};f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(e,r,n){return e=+e,r=r>>>0,n||V(this,e,r,2,65535,0),this[r]=e&255,this[r+1]=e>>>8,r+2};f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(e,r,n){return e=+e,r=r>>>0,n||V(this,e,r,2,65535,0),this[r]=e>>>8,this[r+1]=e&255,r+2};f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(e,r,n){return e=+e,r=r>>>0,n||V(this,e,r,4,4294967295,0),this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=e&255,r+4};f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(e,r,n){return e=+e,r=r>>>0,n||V(this,e,r,4,4294967295,0),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=e&255,r+4};f.prototype.writeIntLE=function(e,r,n,i){if(e=+e,r=r>>>0,!i){var a=Math.pow(2,8*n-1);V(this,e,r,n,a-1,-a)}var c=0,v=1,u=0;for(this[r]=e&255;++c<n&&(v*=256);)e<0&&u===0&&this[r+c-1]!==0&&(u=1),this[r+c]=(e/v>>0)-u&255;return r+n};f.prototype.writeIntBE=function(e,r,n,i){if(e=+e,r=r>>>0,!i){var a=Math.pow(2,8*n-1);V(this,e,r,n,a-1,-a)}var c=n-1,v=1,u=0;for(this[r+c]=e&255;--c>=0&&(v*=256);)e<0&&u===0&&this[r+c+1]!==0&&(u=1),this[r+c]=(e/v>>0)-u&255;return r+n};f.prototype.writeInt8=function(e,r,n){return e=+e,r=r>>>0,n||V(this,e,r,1,127,-128),e<0&&(e=255+e+1),this[r]=e&255,r+1};f.prototype.writeInt16LE=function(e,r,n){return e=+e,r=r>>>0,n||V(this,e,r,2,32767,-32768),this[r]=e&255,this[r+1]=e>>>8,r+2};f.prototype.writeInt16BE=function(e,r,n){return e=+e,r=r>>>0,n||V(this,e,r,2,32767,-32768),this[r]=e>>>8,this[r+1]=e&255,r+2};f.prototype.writeInt32LE=function(e,r,n){return e=+e,r=r>>>0,n||V(this,e,r,4,2147483647,-2147483648),this[r]=e&255,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24,r+4};f.prototype.writeInt32BE=function(e,r,n){return e=+e,r=r>>>0,n||V(this,e,r,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=e&255,r+4};function or(t,e,r,n,i,a){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function ar(t,e,r,n,i){return e=+e,r=r>>>0,i||or(t,e,r,4,34028234663852886e22,-34028234663852886e22),fe.write(t,e,r,n,23,4),r+4}f.prototype.writeFloatLE=function(e,r,n){return ar(this,e,r,!0,n)};f.prototype.writeFloatBE=function(e,r,n){return ar(this,e,r,!1,n)};function sr(t,e,r,n,i){return e=+e,r=r>>>0,i||or(t,e,r,8,17976931348623157e292,-17976931348623157e292),fe.write(t,e,r,n,52,8),r+8}f.prototype.writeDoubleLE=function(e,r,n){return sr(this,e,r,!0,n)};f.prototype.writeDoubleBE=function(e,r,n){return sr(this,e,r,!1,n)};f.prototype.copy=function(e,r,n,i){if(!f.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),r>=e.length&&(r=e.length),r||(r=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-r<i-n&&(i=e.length-r+n);var a=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(r,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),r),a};f.prototype.fill=function(e,r,n,i){if(typeof e=="string"){if(typeof r=="string"?(i=r,r=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!f.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){var a=e.charCodeAt(0);(i==="utf8"&&a<128||i==="latin1")&&(e=a)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;r=r>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);var c;if(typeof e=="number")for(c=r;c<n;++c)this[c]=e;else{var v=f.isBuffer(e)?e:f.from(e,i),u=v.length;if(u===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(c=0;c<n-r;++c)this[c+r]=v[c%u]}return this};var Or=/[^+/0-9A-Za-z-_]/g;function Hr(t){if(t=t.split("=")[0],t=t.trim().replace(Or,""),t.length<2)return"";for(;t.length%4!==0;)t=t+"=";return t}function Me(t,e){e=e||1/0;for(var r,n=t.length,i=null,a=[],c=0;c<n;++c){if(r=t.charCodeAt(c),r>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&a.push(239,191,189);continue}else if(c+1===n){(e-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&a.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,r&63|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,r&63|128)}else if(r<1114112){if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,r&63|128)}else throw new Error("Invalid code point")}return a}function jr(t){for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r)&255);return e}function Kr(t,e){for(var r,n,i,a=[],c=0;c<t.length&&!((e-=2)<0);++c)r=t.charCodeAt(c),n=r>>8,i=r%256,a.push(i),a.push(n);return a}function cr(t){return Be.toByteArray(Hr(t))}function ke(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function Z(t,e){return t instanceof e||t!=null&&t.constructor!=null&&t.constructor.name!=null&&t.constructor.name===e.name}function De(t){return t!==t}var Vr=function(){for(var t="0123456789abcdef",e=new Array(256),r=0;r<16;++r)for(var n=r*16,i=0;i<16;++i)e[n+i]=t[r]+t[i];return e}()});var fr=de((rt,Ae)=>{"use strict";(function(){"use strict";var t="input is invalid type",e=typeof window=="object",r=e?window:{};r.JS_SHA256_NO_WINDOW&&(e=!1);var n=!e&&typeof self=="object",i=!r.JS_SHA256_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;i?r=global:n&&(r=self);var a=!r.JS_SHA256_NO_COMMON_JS&&typeof Ae=="object"&&Ae.exports,c=typeof define=="function"&&define.amd,v=!r.JS_SHA256_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",u="0123456789abcdef".split(""),_=[-2147483648,8388608,32768,128],S=[24,16,8,0],I=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],D=["hex","array","digest","arrayBuffer"],C=[];(r.JS_SHA256_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(l){return Object.prototype.toString.call(l)==="[object Array]"}),v&&(r.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(l){return typeof l=="object"&&l.buffer&&l.buffer.constructor===ArrayBuffer});var Y=function(l,g){return function(E){return new N(g,!0).update(E)[l]()}},ce=function(l){var g=Y("hex",l);i&&(g=W(g,l)),g.create=function(){return new N(l)},g.update=function(F){return g.create().update(F)};for(var E=0;E<D.length;++E){var k=D[E];g[k]=Y(k,l)}return g},W=function(l,g){var E=Xe(),k=ur().Buffer,F=g?"sha224":"sha256",y;k.from&&!r.JS_SHA256_NO_BUFFER_FROM?y=k.from:y=function(p){return new k(p)};var B=function(p){if(typeof p=="string")return E.createHash(F).update(p,"utf8").digest("hex");if(p==null)throw new Error(t);return p.constructor===ArrayBuffer&&(p=new Uint8Array(p)),Array.isArray(p)||ArrayBuffer.isView(p)||p.constructor===k?E.createHash(F).update(y(p)).digest("hex"):l(p)};return B},me=function(l,g){return function(E,k){return new ie(E,g,!0).update(k)[l]()}},G=function(l){var g=me("hex",l);g.create=function(F){return new ie(F,l)},g.update=function(F,y){return g.create(F).update(y)};for(var E=0;E<D.length;++E){var k=D[E];g[k]=me(k,l)}return g};function N(l,g){g?(C[0]=C[16]=C[1]=C[2]=C[3]=C[4]=C[5]=C[6]=C[7]=C[8]=C[9]=C[10]=C[11]=C[12]=C[13]=C[14]=C[15]=0,this.blocks=C):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=l}N.prototype.update=function(l){if(!this.finalized){var g,E=typeof l;if(E!=="string"){if(E==="object"){if(l===null)throw new Error(t);if(v&&l.constructor===ArrayBuffer)l=new Uint8Array(l);else if(!Array.isArray(l)&&(!v||!ArrayBuffer.isView(l)))throw new Error(t)}else throw new Error(t);g=!0}for(var k,F=0,y,B=l.length,p=this.blocks;F<B;){if(this.hashed&&(this.hashed=!1,p[0]=this.block,p[16]=p[1]=p[2]=p[3]=p[4]=p[5]=p[6]=p[7]=p[8]=p[9]=p[10]=p[11]=p[12]=p[13]=p[14]=p[15]=0),g)for(y=this.start;F<B&&y<64;++F)p[y>>2]|=l[F]<<S[y++&3];else for(y=this.start;F<B&&y<64;++F)k=l.charCodeAt(F),k<128?p[y>>2]|=k<<S[y++&3]:k<2048?(p[y>>2]|=(192|k>>6)<<S[y++&3],p[y>>2]|=(128|k&63)<<S[y++&3]):k<55296||k>=57344?(p[y>>2]|=(224|k>>12)<<S[y++&3],p[y>>2]|=(128|k>>6&63)<<S[y++&3],p[y>>2]|=(128|k&63)<<S[y++&3]):(k=65536+((k&1023)<<10|l.charCodeAt(++F)&1023),p[y>>2]|=(240|k>>18)<<S[y++&3],p[y>>2]|=(128|k>>12&63)<<S[y++&3],p[y>>2]|=(128|k>>6&63)<<S[y++&3],p[y>>2]|=(128|k&63)<<S[y++&3]);this.lastByteIndex=y,this.bytes+=y-this.start,y>=64?(this.block=p[16],this.start=y-64,this.hash(),this.hashed=!0):this.start=y}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},N.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var l=this.blocks,g=this.lastByteIndex;l[16]=this.block,l[g>>2]|=_[g&3],this.block=l[16],g>=56&&(this.hashed||this.hash(),l[0]=this.block,l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0),l[14]=this.hBytes<<3|this.bytes>>>29,l[15]=this.bytes<<3,this.hash()}},N.prototype.hash=function(){var l=this.h0,g=this.h1,E=this.h2,k=this.h3,F=this.h4,y=this.h5,B=this.h6,p=this.h7,T=this.blocks,P,H,j,z,L,X,o,s,d,w,h;for(P=16;P<64;++P)L=T[P-15],H=(L>>>7|L<<25)^(L>>>18|L<<14)^L>>>3,L=T[P-2],j=(L>>>17|L<<15)^(L>>>19|L<<13)^L>>>10,T[P]=T[P-16]+H+T[P-7]+j<<0;for(h=g&E,P=0;P<64;P+=4)this.first?(this.is224?(s=300032,L=T[0]-1413257819,p=L-150054599<<0,k=L+24177077<<0):(s=704751109,L=T[0]-210244248,p=L-1521486534<<0,k=L+143694565<<0),this.first=!1):(H=(l>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),j=(F>>>6|F<<26)^(F>>>11|F<<21)^(F>>>25|F<<7),s=l&g,z=s^l&E^h,o=F&y^~F&B,L=p+j+o+I[P]+T[P],X=H+z,p=k+L<<0,k=L+X<<0),H=(k>>>2|k<<30)^(k>>>13|k<<19)^(k>>>22|k<<10),j=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),d=k&l,z=d^k&g^s,o=p&F^~p&y,L=B+j+o+I[P+1]+T[P+1],X=H+z,B=E+L<<0,E=L+X<<0,H=(E>>>2|E<<30)^(E>>>13|E<<19)^(E>>>22|E<<10),j=(B>>>6|B<<26)^(B>>>11|B<<21)^(B>>>25|B<<7),w=E&k,z=w^E&l^d,o=B&p^~B&F,L=y+j+o+I[P+2]+T[P+2],X=H+z,y=g+L<<0,g=L+X<<0,H=(g>>>2|g<<30)^(g>>>13|g<<19)^(g>>>22|g<<10),j=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7),h=g&E,z=h^g&k^w,o=y&B^~y&p,L=F+j+o+I[P+3]+T[P+3],X=H+z,F=l+L<<0,l=L+X<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+l<<0,this.h1=this.h1+g<<0,this.h2=this.h2+E<<0,this.h3=this.h3+k<<0,this.h4=this.h4+F<<0,this.h5=this.h5+y<<0,this.h6=this.h6+B<<0,this.h7=this.h7+p<<0},N.prototype.hex=function(){this.finalize();var l=this.h0,g=this.h1,E=this.h2,k=this.h3,F=this.h4,y=this.h5,B=this.h6,p=this.h7,T=u[l>>28&15]+u[l>>24&15]+u[l>>20&15]+u[l>>16&15]+u[l>>12&15]+u[l>>8&15]+u[l>>4&15]+u[l&15]+u[g>>28&15]+u[g>>24&15]+u[g>>20&15]+u[g>>16&15]+u[g>>12&15]+u[g>>8&15]+u[g>>4&15]+u[g&15]+u[E>>28&15]+u[E>>24&15]+u[E>>20&15]+u[E>>16&15]+u[E>>12&15]+u[E>>8&15]+u[E>>4&15]+u[E&15]+u[k>>28&15]+u[k>>24&15]+u[k>>20&15]+u[k>>16&15]+u[k>>12&15]+u[k>>8&15]+u[k>>4&15]+u[k&15]+u[F>>28&15]+u[F>>24&15]+u[F>>20&15]+u[F>>16&15]+u[F>>12&15]+u[F>>8&15]+u[F>>4&15]+u[F&15]+u[y>>28&15]+u[y>>24&15]+u[y>>20&15]+u[y>>16&15]+u[y>>12&15]+u[y>>8&15]+u[y>>4&15]+u[y&15]+u[B>>28&15]+u[B>>24&15]+u[B>>20&15]+u[B>>16&15]+u[B>>12&15]+u[B>>8&15]+u[B>>4&15]+u[B&15];return this.is224||(T+=u[p>>28&15]+u[p>>24&15]+u[p>>20&15]+u[p>>16&15]+u[p>>12&15]+u[p>>8&15]+u[p>>4&15]+u[p&15]),T},N.prototype.toString=N.prototype.hex,N.prototype.digest=function(){this.finalize();var l=this.h0,g=this.h1,E=this.h2,k=this.h3,F=this.h4,y=this.h5,B=this.h6,p=this.h7,T=[l>>24&255,l>>16&255,l>>8&255,l&255,g>>24&255,g>>16&255,g>>8&255,g&255,E>>24&255,E>>16&255,E>>8&255,E&255,k>>24&255,k>>16&255,k>>8&255,k&255,F>>24&255,F>>16&255,F>>8&255,F&255,y>>24&255,y>>16&255,y>>8&255,y&255,B>>24&255,B>>16&255,B>>8&255,B&255];return this.is224||T.push(p>>24&255,p>>16&255,p>>8&255,p&255),T},N.prototype.array=N.prototype.digest,N.prototype.arrayBuffer=function(){this.finalize();var l=new ArrayBuffer(this.is224?28:32),g=new DataView(l);return g.setUint32(0,this.h0),g.setUint32(4,this.h1),g.setUint32(8,this.h2),g.setUint32(12,this.h3),g.setUint32(16,this.h4),g.setUint32(20,this.h5),g.setUint32(24,this.h6),this.is224||g.setUint32(28,this.h7),l};function ie(l,g,E){var k,F=typeof l;if(F==="string"){var y=[],B=l.length,p=0,T;for(k=0;k<B;++k)T=l.charCodeAt(k),T<128?y[p++]=T:T<2048?(y[p++]=192|T>>6,y[p++]=128|T&63):T<55296||T>=57344?(y[p++]=224|T>>12,y[p++]=128|T>>6&63,y[p++]=128|T&63):(T=65536+((T&1023)<<10|l.charCodeAt(++k)&1023),y[p++]=240|T>>18,y[p++]=128|T>>12&63,y[p++]=128|T>>6&63,y[p++]=128|T&63);l=y}else if(F==="object"){if(l===null)throw new Error(t);if(v&&l.constructor===ArrayBuffer)l=new Uint8Array(l);else if(!Array.isArray(l)&&(!v||!ArrayBuffer.isView(l)))throw new Error(t)}else throw new Error(t);l.length>64&&(l=new N(g,!0).update(l).array());var P=[],H=[];for(k=0;k<64;++k){var j=l[k]||0;P[k]=92^j,H[k]=54^j}N.call(this,g,E),this.update(H),this.oKeyPad=P,this.inner=!0,this.sharedMemory=E}ie.prototype=new N,ie.prototype.finalize=function(){if(N.prototype.finalize.call(this),this.inner){this.inner=!1;var l=this.array();N.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(l),N.prototype.finalize.call(this)}};var K=ce();K.sha256=K,K.sha224=ce(!0),K.sha256.hmac=G(),K.sha224.hmac=G(!0),a?Ae.exports=K:(r.sha256=K.sha256,r.sha224=K.sha224,c&&define(function(){return K}))})()});var lr=He(Re(),1),hr=He(fr(),1);var se=class extends Error{};se.prototype.name="InvalidTokenError";function zr(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,r)=>{let n=r.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function Jr(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return zr(e)}catch{return atob(e)}}function Fe(t,e){if(typeof t!="string")throw new se("Invalid token specified: must be a string");e||(e={});let r=e.header===!0?0:1,n=t.split(".")[r];if(typeof n!="string")throw new se(`Invalid token specified: missing part #${r+1}`);let i;try{i=Jr(n)}catch(a){throw new se(`Invalid token specified: invalid base64 for part #${r+1} (${a.message})`)}try{return JSON.parse(i)}catch(a){throw new se(`Invalid token specified: invalid json for part #${r+1} (${a.message})`)}}if(typeof Promise>"u")throw Error("Keycloak requires an environment that supports Promises. Make sure that you include the appropriate polyfill.");function Oe(t){if(!(this instanceof Oe))throw new Error("The 'Keycloak' constructor must be invoked with 'new'.");for(var e=this,r,n=[],i,a={enable:!0,callbackList:[],interval:5},c=document.getElementsByTagName("script"),v=0;v<c.length;v++)(c[v].src.indexOf("keycloak.js")!==-1||c[v].src.indexOf("keycloak.min.js")!==-1)&&c[v].src.indexOf("version=")!==-1&&(e.iframeVersion=c[v].src.substring(c[v].src.indexOf("version=")+8).split("&")[0]);var u=!0,_=X(console.info),S=X(console.warn);e.init=function(o){if(e.didInitialize)throw new Error("A 'Keycloak' instance can only be initialized once.");e.didInitialize=!0,e.authenticated=!1,i=L();var s=["default","cordova","cordova-native"];if(o&&s.indexOf(o.adapter)>-1?r=H(o.adapter):o&&typeof o.adapter=="object"?r=o.adapter:window.Cordova||window.cordova?r=H("cordova"):r=H(),o){if(typeof o.useNonce<"u"&&(u=o.useNonce),typeof o.checkLoginIframe<"u"&&(a.enable=o.checkLoginIframe),o.checkLoginIframeInterval&&(a.interval=o.checkLoginIframeInterval),o.onLoad==="login-required"&&(e.loginRequired=!0),o.responseMode)if(o.responseMode==="query"||o.responseMode==="fragment")e.responseMode=o.responseMode;else throw"Invalid value for responseMode";if(o.flow){switch(o.flow){case"standard":e.responseType="code";break;case"implicit":e.responseType="id_token token";break;case"hybrid":e.responseType="code id_token token";break;default:throw"Invalid value for flow"}e.flow=o.flow}if(o.timeSkew!=null&&(e.timeSkew=o.timeSkew),o.redirectUri&&(e.redirectUri=o.redirectUri),o.silentCheckSsoRedirectUri&&(e.silentCheckSsoRedirectUri=o.silentCheckSsoRedirectUri),typeof o.silentCheckSsoFallback=="boolean"?e.silentCheckSsoFallback=o.silentCheckSsoFallback:e.silentCheckSsoFallback=!0,o.pkceMethod){if(o.pkceMethod!=="S256")throw"Invalid value for pkceMethod";e.pkceMethod=o.pkceMethod}typeof o.enableLogging=="boolean"?e.enableLogging=o.enableLogging:e.enableLogging=!1,typeof o.scope=="string"&&(e.scope=o.scope),typeof o.acrValues=="string"&&(e.acrValues=o.acrValues),typeof o.messageReceiveTimeout=="number"&&o.messageReceiveTimeout>0?e.messageReceiveTimeout=o.messageReceiveTimeout:e.messageReceiveTimeout=1e4}e.responseMode||(e.responseMode="fragment"),e.responseType||(e.responseType="code",e.flow="standard");var d=F(),w=F();w.promise.then(function(){e.onReady&&e.onReady(e.authenticated),d.setSuccess(e.authenticated)}).catch(function(b){d.setError(b)});var h=N();function A(){var b=function(M){M||(R.prompt="none"),o&&o.locale&&(R.locale=o.locale),e.login(R).then(function(){w.setSuccess()}).catch(function(q){w.setError(q)})},U=function(){var M=document.createElement("iframe"),q=e.createLoginUrl({prompt:"none",redirectUri:e.silentCheckSsoRedirectUri});M.setAttribute("src",q),M.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),M.setAttribute("title","keycloak-silent-check-sso"),M.style.display="none",document.body.appendChild(M);var ne=function(J){if(!(J.origin!==window.location.origin||M.contentWindow!==J.source)){var he=g(J.data);G(he,w),document.body.removeChild(M),window.removeEventListener("message",ne)}};window.addEventListener("message",ne)},R={};switch(o.onLoad){case"check-sso":a.enable?B().then(function(){T().then(function(M){M?w.setSuccess():e.silentCheckSsoRedirectUri?U():b(!1)}).catch(function(M){w.setError(M)})}):e.silentCheckSsoRedirectUri?U():b(!1);break;case"login-required":b(!0);break;default:throw"Invalid value for onLoad"}}function x(){var b=g(window.location.href);if(b&&window.history.replaceState(window.history.state,null,b.newUrl),b&&b.valid)return B().then(function(){G(b,w)}).catch(function(U){w.setError(U)});o?o.token&&o.refreshToken?(K(o.token,o.refreshToken,o.idToken),a.enable?B().then(function(){T().then(function(U){U?(e.onAuthSuccess&&e.onAuthSuccess(),w.setSuccess(),p()):w.setSuccess()}).catch(function(U){w.setError(U)})}):e.updateToken(-1).then(function(){e.onAuthSuccess&&e.onAuthSuccess(),w.setSuccess()}).catch(function(U){e.onAuthError&&e.onAuthError(),o.onLoad?A():w.setError(U)})):o.onLoad?A():w.setSuccess():w.setSuccess()}function m(){var b=F(),U=function(){(document.readyState==="interactive"||document.readyState==="complete")&&(document.removeEventListener("readystatechange",U),b.setSuccess())};return document.addEventListener("readystatechange",U),U(),b.promise}return h.then(function(){m().then(P).then(x).catch(function(b){d.setError(b)})}),h.catch(function(b){d.setError(b)}),d.promise},e.login=function(o){return r.login(o)};function I(o){var s=null,d=window.crypto||window.msCrypto;if(d&&d.getRandomValues&&window.Uint8Array)return s=new Uint8Array(o),d.getRandomValues(s),s;s=new Array(o);for(var w=0;w<s.length;w++)s[w]=Math.floor(256*Math.random());return s}function D(o){return C(o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")}function C(o,s){for(var d=I(o),w=new Array(o),h=0;h<o;h++)w[h]=s.charCodeAt(d[h]%s.length);return String.fromCharCode.apply(null,w)}function Y(o,s){switch(o){case"S256":var d=new Uint8Array(hr.default.arrayBuffer(s)),w=lr.default.fromByteArray(d).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"");return w;default:throw"Invalid value for pkceMethod"}}function ce(o){var s={id_token:{acr:o}};return JSON.stringify(s)}e.createLoginUrl=function(o){var s=l(),d=l(),w=r.redirectUri(o),h={state:s,nonce:d,redirectUri:encodeURIComponent(w)};o&&o.prompt&&(h.prompt=o.prompt);var A;o&&o.action=="register"?A=e.endpoints.register():A=e.endpoints.authorize();var x=o&&o.scope||e.scope;x?x.indexOf("openid")===-1&&(x="openid "+x):x="openid";var m=A+"?client_id="+encodeURIComponent(e.clientId)+"&redirect_uri="+encodeURIComponent(w)+"&state="+encodeURIComponent(s)+"&response_mode="+encodeURIComponent(e.responseMode)+"&response_type="+encodeURIComponent(e.responseType)+"&scope="+encodeURIComponent(x);if(u&&(m=m+"&nonce="+encodeURIComponent(d)),o&&o.prompt&&(m+="&prompt="+encodeURIComponent(o.prompt)),o&&o.maxAge&&(m+="&max_age="+encodeURIComponent(o.maxAge)),o&&o.loginHint&&(m+="&login_hint="+encodeURIComponent(o.loginHint)),o&&o.idpHint&&(m+="&kc_idp_hint="+encodeURIComponent(o.idpHint)),o&&o.action&&o.action!="register"&&(m+="&kc_action="+encodeURIComponent(o.action)),o&&o.locale&&(m+="&ui_locales="+encodeURIComponent(o.locale)),o&&o.acr){var b=ce(o.acr);m+="&claims="+encodeURIComponent(b)}if((o&&o.acrValues||e.acrValues)&&(m+="&acr_values="+encodeURIComponent(o.acrValues||e.acrValues)),e.pkceMethod){var U=D(96);h.pkceCodeVerifier=U;var R=Y(e.pkceMethod,U);m+="&code_challenge="+R,m+="&code_challenge_method="+e.pkceMethod}return i.add(h),m},e.logout=function(o){return r.logout(o)},e.createLogoutUrl=function(o){var s=e.endpoints.logout()+"?client_id="+encodeURIComponent(e.clientId)+"&post_logout_redirect_uri="+encodeURIComponent(r.redirectUri(o,!1));return e.idToken&&(s+="&id_token_hint="+encodeURIComponent(e.idToken)),s},e.register=function(o){return r.register(o)},e.createRegisterUrl=function(o){return o||(o={}),o.action="register",e.createLoginUrl(o)},e.createAccountUrl=function(o){var s=W(),d=void 0;return typeof s<"u"&&(d=s+"/account?referrer="+encodeURIComponent(e.clientId)+"&referrer_uri="+encodeURIComponent(r.redirectUri(o))),d},e.accountManagement=function(){return r.accountManagement()},e.hasRealmRole=function(o){var s=e.realmAccess;return!!s&&s.roles.indexOf(o)>=0},e.hasResourceRole=function(o,s){if(!e.resourceAccess)return!1;var d=e.resourceAccess[s||e.clientId];return!!d&&d.roles.indexOf(o)>=0},e.loadUserProfile=function(){var o=W()+"/account",s=new XMLHttpRequest;s.open("GET",o,!0),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Authorization","bearer "+e.token);var d=F();return s.onreadystatechange=function(){s.readyState==4&&(s.status==200?(e.profile=JSON.parse(s.responseText),d.setSuccess(e.profile)):d.setError())},s.send(),d.promise},e.loadUserInfo=function(){var o=e.endpoints.userinfo(),s=new XMLHttpRequest;s.open("GET",o,!0),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Authorization","bearer "+e.token);var d=F();return s.onreadystatechange=function(){s.readyState==4&&(s.status==200?(e.userInfo=JSON.parse(s.responseText),d.setSuccess(e.userInfo)):d.setError())},s.send(),d.promise},e.isTokenExpired=function(o){if(!e.tokenParsed||!e.refreshToken&&e.flow!="implicit")throw"Not authenticated";if(e.timeSkew==null)return _("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var s=e.tokenParsed.exp-Math.ceil(new Date().getTime()/1e3)+e.timeSkew;if(o){if(isNaN(o))throw"Invalid minValidity";s-=o}return s<0},e.updateToken=function(o){var s=F();if(!e.refreshToken)return s.setError(),s.promise;o=o||5;var d=function(){var h=!1;if(o==-1?(h=!0,_("[KEYCLOAK] Refreshing token: forced refresh")):(!e.tokenParsed||e.isTokenExpired(o))&&(h=!0,_("[KEYCLOAK] Refreshing token: token expired")),!h)s.setSuccess(!1);else{var A="grant_type=refresh_token&refresh_token="+e.refreshToken,x=e.endpoints.token();if(n.push(s),n.length==1){var m=new XMLHttpRequest;m.open("POST",x,!0),m.setRequestHeader("Content-type","application/x-www-form-urlencoded"),m.withCredentials=!0,A+="&client_id="+encodeURIComponent(e.clientId);var b=new Date().getTime();m.onreadystatechange=function(){if(m.readyState==4)if(m.status==200){_("[KEYCLOAK] Token refreshed"),b=(b+new Date().getTime())/2;var U=JSON.parse(m.responseText);K(U.access_token,U.refresh_token,U.id_token,b),e.onAuthRefreshSuccess&&e.onAuthRefreshSuccess();for(var R=n.pop();R!=null;R=n.pop())R.setSuccess(!0)}else{S("[KEYCLOAK] Failed to refresh token"),m.status==400&&e.clearToken(),e.onAuthRefreshError&&e.onAuthRefreshError();for(var R=n.pop();R!=null;R=n.pop())R.setError(!0)}},m.send(A)}}};if(a.enable){var w=T();w.then(function(){d()}).catch(function(h){s.setError(h)})}else d();return s.promise},e.clearToken=function(){e.token&&(K(null,null,null),e.onAuthLogout&&e.onAuthLogout(),e.loginRequired&&e.login())};function W(){if(typeof e.authServerUrl<"u")return e.authServerUrl.charAt(e.authServerUrl.length-1)=="/"?e.authServerUrl+"realms/"+encodeURIComponent(e.realm):e.authServerUrl+"/realms/"+encodeURIComponent(e.realm)}function me(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}function G(o,s){var d=o.code,w=o.error,h=o.prompt,A=new Date().getTime();if(o.kc_action_status&&e.onActionUpdate&&e.onActionUpdate(o.kc_action_status),w){if(h!="none"){var x={error:w,error_description:o.error_description};e.onAuthError&&e.onAuthError(x),s&&s.setError(x)}else s&&s.setSuccess();return}else e.flow!="standard"&&(o.access_token||o.id_token)&&R(o.access_token,null,o.id_token,!0);if(e.flow!="implicit"&&d){var m="code="+d+"&grant_type=authorization_code",b=e.endpoints.token(),U=new XMLHttpRequest;U.open("POST",b,!0),U.setRequestHeader("Content-type","application/x-www-form-urlencoded"),m+="&client_id="+encodeURIComponent(e.clientId),m+="&redirect_uri="+o.redirectUri,o.pkceCodeVerifier&&(m+="&code_verifier="+o.pkceCodeVerifier),U.withCredentials=!0,U.onreadystatechange=function(){if(U.readyState==4)if(U.status==200){var M=JSON.parse(U.responseText);R(M.access_token,M.refresh_token,M.id_token,e.flow==="standard"),p()}else e.onAuthError&&e.onAuthError(),s&&s.setError()},U.send(m)}function R(M,q,ne,J){A=(A+new Date().getTime())/2,K(M,q,ne,A),u&&(e.tokenParsed&&e.tokenParsed.nonce!=o.storedNonce||e.refreshTokenParsed&&e.refreshTokenParsed.nonce!=o.storedNonce||e.idTokenParsed&&e.idTokenParsed.nonce!=o.storedNonce)?(_("[KEYCLOAK] Invalid nonce, clearing token"),e.clearToken(),s&&s.setError()):J&&(e.onAuthSuccess&&e.onAuthSuccess(),s&&s.setSuccess())}}function N(o){var s=F(),d;t?typeof t=="string"&&(d=t):d="keycloak.json";function w(U){U?e.endpoints={authorize:function(){return U.authorization_endpoint},token:function(){return U.token_endpoint},logout:function(){if(!U.end_session_endpoint)throw"Not supported by the OIDC server";return U.end_session_endpoint},checkSessionIframe:function(){if(!U.check_session_iframe)throw"Not supported by the OIDC server";return U.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!U.userinfo_endpoint)throw"Not supported by the OIDC server";return U.userinfo_endpoint}}:e.endpoints={authorize:function(){return W()+"/protocol/openid-connect/auth"},token:function(){return W()+"/protocol/openid-connect/token"},logout:function(){return W()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){var R=W()+"/protocol/openid-connect/login-status-iframe.html";return e.iframeVersion&&(R=R+"?version="+e.iframeVersion),R},thirdPartyCookiesIframe:function(){var R=W()+"/protocol/openid-connect/3p-cookies/step1.html";return e.iframeVersion&&(R=R+"?version="+e.iframeVersion),R},register:function(){return W()+"/protocol/openid-connect/registrations"},userinfo:function(){return W()+"/protocol/openid-connect/userinfo"}}}if(d){var h=new XMLHttpRequest;h.open("GET",d,!0),h.setRequestHeader("Accept","application/json"),h.onreadystatechange=function(){if(h.readyState==4)if(h.status==200||ie(h)){var U=JSON.parse(h.responseText);e.authServerUrl=U["auth-server-url"],e.realm=U.realm,e.clientId=U.resource,w(null),s.setSuccess()}else s.setError()},h.send()}else{if(!t.clientId)throw"clientId missing";e.clientId=t.clientId;var A=t.oidcProvider;if(A)if(typeof A=="string"){var b;A.charAt(A.length-1)=="/"?b=A+".well-known/openid-configuration":b=A+"/.well-known/openid-configuration";var h=new XMLHttpRequest;h.open("GET",b,!0),h.setRequestHeader("Accept","application/json"),h.onreadystatechange=function(){if(h.readyState==4)if(h.status==200||ie(h)){var R=JSON.parse(h.responseText);w(R),s.setSuccess()}else s.setError()},h.send()}else w(A),s.setSuccess();else{if(!t.url){for(var x=document.getElementsByTagName("script"),m=0;m<x.length;m++)if(x[m].src.match(/.*keycloak\.js/)){t.url=x[m].src.substr(0,x[m].src.indexOf("/js/keycloak.js"));break}}if(!t.realm)throw"realm missing";e.authServerUrl=t.url,e.realm=t.realm,w(null),s.setSuccess()}}return s.promise}function ie(o){return o.status==0&&o.responseText&&o.responseURL.startsWith("file:")}function K(o,s,d,w){if(e.tokenTimeoutHandle&&(clearTimeout(e.tokenTimeoutHandle),e.tokenTimeoutHandle=null),s?(e.refreshToken=s,e.refreshTokenParsed=Fe(s)):(delete e.refreshToken,delete e.refreshTokenParsed),d?(e.idToken=d,e.idTokenParsed=Fe(d)):(delete e.idToken,delete e.idTokenParsed),o){if(e.token=o,e.tokenParsed=Fe(o),e.sessionId=e.tokenParsed.session_state,e.authenticated=!0,e.subject=e.tokenParsed.sub,e.realmAccess=e.tokenParsed.realm_access,e.resourceAccess=e.tokenParsed.resource_access,w&&(e.timeSkew=Math.floor(w/1e3)-e.tokenParsed.iat),e.timeSkew!=null&&(_("[KEYCLOAK] Estimated time difference between browser and server is "+e.timeSkew+" seconds"),e.onTokenExpired)){var h=(e.tokenParsed.exp-new Date().getTime()/1e3+e.timeSkew)*1e3;_("[KEYCLOAK] Token expires in "+Math.round(h/1e3)+" s"),h<=0?e.onTokenExpired():e.tokenTimeoutHandle=setTimeout(e.onTokenExpired,h)}}else delete e.token,delete e.tokenParsed,delete e.subject,delete e.realmAccess,delete e.resourceAccess,e.authenticated=!1}function l(){var o="0123456789abcdef",s=C(36,o).split("");s[14]="4",s[19]=o.substr(s[19]&3|8,1),s[8]=s[13]=s[18]=s[23]="-";var d=s.join("");return d}function g(o){var s=E(o);if(s){var d=i.get(s.state);return d&&(s.valid=!0,s.redirectUri=d.redirectUri,s.storedNonce=d.nonce,s.prompt=d.prompt,s.pkceCodeVerifier=d.pkceCodeVerifier),s}}function E(o){var s;switch(e.flow){case"standard":s=["code","state","session_state","kc_action_status","iss"];break;case"implicit":s=["access_token","token_type","id_token","state","session_state","expires_in","kc_action_status","iss"];break;case"hybrid":s=["access_token","token_type","id_token","code","state","session_state","expires_in","kc_action_status","iss"];break}s.push("error"),s.push("error_description"),s.push("error_uri");var d=o.indexOf("?"),w=o.indexOf("#"),h,A;if(e.responseMode==="query"&&d!==-1?(h=o.substring(0,d),A=k(o.substring(d+1,w!==-1?w:o.length),s),A.paramsString!==""&&(h+="?"+A.paramsString),w!==-1&&(h+=o.substring(w))):e.responseMode==="fragment"&&w!==-1&&(h=o.substring(0,w),A=k(o.substring(w+1),s),A.paramsString!==""&&(h+="#"+A.paramsString)),A&&A.oauthParams){if(e.flow==="standard"||e.flow==="hybrid"){if((A.oauthParams.code||A.oauthParams.error)&&A.oauthParams.state)return A.oauthParams.newUrl=h,A.oauthParams}else if(e.flow==="implicit"&&(A.oauthParams.access_token||A.oauthParams.error)&&A.oauthParams.state)return A.oauthParams.newUrl=h,A.oauthParams}}function k(o,s){for(var d=o.split("&"),w={paramsString:"",oauthParams:{}},h=0;h<d.length;h++){var A=d[h].indexOf("="),x=d[h].slice(0,A);s.indexOf(x)!==-1?w.oauthParams[x]=d[h].slice(A+1):(w.paramsString!==""&&(w.paramsString+="&"),w.paramsString+=d[h])}return w}function F(){var o={setSuccess:function(s){o.resolve(s)},setError:function(s){o.reject(s)}};return o.promise=new Promise(function(s,d){o.resolve=s,o.reject=d}),o}function y(o,s,d){var w=null,h=new Promise(function(A,x){w=setTimeout(function(){x({error:d||"Promise is not settled within timeout of "+s+"ms"})},s)});return Promise.race([o,h]).finally(function(){clearTimeout(w)})}function B(){var o=F();if(!a.enable||a.iframe)return o.setSuccess(),o.promise;var s=document.createElement("iframe");a.iframe=s,s.onload=function(){var h=e.endpoints.authorize();h.charAt(0)==="/"?a.iframeOrigin=me():a.iframeOrigin=h.substring(0,h.indexOf("/",8)),o.setSuccess()};var d=e.endpoints.checkSessionIframe();s.setAttribute("src",d),s.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),s.setAttribute("title","keycloak-session-iframe"),s.style.display="none",document.body.appendChild(s);var w=function(h){if(!(h.origin!==a.iframeOrigin||a.iframe.contentWindow!==h.source)&&(h.data=="unchanged"||h.data=="changed"||h.data=="error")){h.data!="unchanged"&&e.clearToken();for(var A=a.callbackList.splice(0,a.callbackList.length),x=A.length-1;x>=0;--x){var m=A[x];h.data=="error"?m.setError():m.setSuccess(h.data=="unchanged")}}};return window.addEventListener("message",w,!1),o.promise}function p(){a.enable&&e.token&&setTimeout(function(){T().then(function(o){o&&p()})},a.interval*1e3)}function T(){var o=F();if(a.iframe&&a.iframeOrigin){var s=e.clientId+" "+(e.sessionId?e.sessionId:"");a.callbackList.push(o);var d=a.iframeOrigin;a.callbackList.length==1&&a.iframe.contentWindow.postMessage(s,d)}else o.setSuccess();return o.promise}function P(){var o=F();if(a.enable||e.silentCheckSsoRedirectUri){var s=document.createElement("iframe");s.setAttribute("src",e.endpoints.thirdPartyCookiesIframe()),s.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),s.setAttribute("title","keycloak-3p-check-iframe"),s.style.display="none",document.body.appendChild(s);var d=function(w){s.contentWindow===w.source&&(w.data!=="supported"&&w.data!=="unsupported"||(w.data==="unsupported"&&(S(`[KEYCLOAK] Your browser is blocking access to 3rd-party cookies, this means:

 - It is not possible to retrieve tokens without redirecting to the Keycloak server (a.k.a. no support for silent authentication).
 - It is not possible to automatically detect changes to the session status (such as the user logging out in another tab).

For more information see: https://www.keycloak.org/docs/latest/securing_apps/#_modern_browsers`),a.enable=!1,e.silentCheckSsoFallback&&(e.silentCheckSsoRedirectUri=!1)),document.body.removeChild(s),window.removeEventListener("message",d),o.setSuccess()))};window.addEventListener("message",d,!1)}else o.setSuccess();return y(o.promise,e.messageReceiveTimeout,"Timeout when waiting for 3rd party check iframe message.")}function H(o){if(!o||o=="default")return{login:function(x){return window.location.assign(e.createLoginUrl(x)),F().promise},logout:function(x){return window.location.replace(e.createLogoutUrl(x)),F().promise},register:function(x){return window.location.assign(e.createRegisterUrl(x)),F().promise},accountManagement:function(){var x=e.createAccountUrl();if(typeof x<"u")window.location.href=x;else throw"Not supported by the OIDC server";return F().promise},redirectUri:function(x,m){return x&&x.redirectUri?x.redirectUri:e.redirectUri?e.redirectUri:location.href}};if(o=="cordova"){a.enable=!1;var s=function(x,m,b){return window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(x,m,b):window.open(x,m,b)},d=function(x){return x&&x.cordovaOptions?Object.keys(x.cordovaOptions).reduce(function(m,b){return m[b]=x.cordovaOptions[b],m},{}):{}},w=function(x){return Object.keys(x).reduce(function(m,b){return m.push(b+"="+x[b]),m},[]).join(",")},h=function(x){var m=d(x);return m.location="no",x&&x.prompt=="none"&&(m.hidden="yes"),w(m)},A=function(){return e.redirectUri||"http://localhost"};return{login:function(x){var m=F(),b=h(x),U=e.createLoginUrl(x),R=s(U,"_blank",b),M=!1,q=!1,ne=function(){q=!0,R.close()};return R.addEventListener("loadstart",function(J){if(J.url.indexOf(A())==0){var he=g(J.url);G(he,m),ne(),M=!0}}),R.addEventListener("loaderror",function(J){if(!M)if(J.url.indexOf(A())==0){var he=g(J.url);G(he,m),ne(),M=!0}else m.setError(),ne()}),R.addEventListener("exit",function(J){q||m.setError({reason:"closed_by_user"})}),m.promise},logout:function(x){var m=F(),b=e.createLogoutUrl(x),U=s(b,"_blank","location=no,hidden=yes,clearcache=yes"),R;return U.addEventListener("loadstart",function(M){M.url.indexOf(A())==0&&U.close()}),U.addEventListener("loaderror",function(M){M.url.indexOf(A())==0||(R=!0),U.close()}),U.addEventListener("exit",function(M){R?m.setError():(e.clearToken(),m.setSuccess())}),m.promise},register:function(x){var m=F(),b=e.createRegisterUrl(),U=h(x),R=s(b,"_blank",U);return R.addEventListener("loadstart",function(M){if(M.url.indexOf(A())==0){R.close();var q=g(M.url);G(q,m)}}),m.promise},accountManagement:function(){var x=e.createAccountUrl();if(typeof x<"u"){var m=s(x,"_blank","location=no");m.addEventListener("loadstart",function(b){b.url.indexOf(A())==0&&m.close()})}else throw"Not supported by the OIDC server"},redirectUri:function(x){return A()}}}if(o=="cordova-native")return a.enable=!1,{login:function(x){var m=F(),b=e.createLoginUrl(x);return universalLinks.subscribe("keycloak",function(U){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();var R=g(U.url);G(R,m)}),window.cordova.plugins.browsertab.openUrl(b),m.promise},logout:function(x){var m=F(),b=e.createLogoutUrl(x);return universalLinks.subscribe("keycloak",function(U){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),e.clearToken(),m.setSuccess()}),window.cordova.plugins.browsertab.openUrl(b),m.promise},register:function(x){var m=F(),b=e.createRegisterUrl(x);return universalLinks.subscribe("keycloak",function(U){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();var R=g(U.url);G(R,m)}),window.cordova.plugins.browsertab.openUrl(b),m.promise},accountManagement:function(){var x=e.createAccountUrl();if(typeof x<"u")window.cordova.plugins.browsertab.openUrl(x);else throw"Not supported by the OIDC server"},redirectUri:function(x){return x&&x.redirectUri?x.redirectUri:e.redirectUri?e.redirectUri:"http://localhost"}};throw"invalid adapter type: "+o}var j=function(){if(!(this instanceof j))return new j;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");var o=this;function s(){for(var d=new Date().getTime(),w=0;w<localStorage.length;w++){var h=localStorage.key(w);if(h&&h.indexOf("kc-callback-")==0){var A=localStorage.getItem(h);if(A)try{var x=JSON.parse(A).expires;(!x||x<d)&&localStorage.removeItem(h)}catch{localStorage.removeItem(h)}}}}o.get=function(d){if(d){var w="kc-callback-"+d,h=localStorage.getItem(w);return h&&(localStorage.removeItem(w),h=JSON.parse(h)),s(),h}},o.add=function(d){s();var w="kc-callback-"+d.state;d.expires=new Date().getTime()+60*60*1e3,localStorage.setItem(w,JSON.stringify(d))}},z=function(){if(!(this instanceof z))return new z;var o=this;o.get=function(h){if(h){var A=d("kc-callback-"+h);if(w("kc-callback-"+h,"",s(-100)),A)return JSON.parse(A)}},o.add=function(h){w("kc-callback-"+h.state,JSON.stringify(h),s(60))},o.removeItem=function(h){w(h,"",s(-100))};var s=function(h){var A=new Date;return A.setTime(A.getTime()+h*60*1e3),A},d=function(h){for(var A=h+"=",x=document.cookie.split(";"),m=0;m<x.length;m++){for(var b=x[m];b.charAt(0)==" ";)b=b.substring(1);if(b.indexOf(A)==0)return b.substring(A.length,b.length)}return""},w=function(h,A,x){var m=h+"="+A+"; expires="+x.toUTCString()+"; ";document.cookie=m}};function L(){try{return new j}catch{}return new z}function X(o){return function(){e.enableLogging&&o.apply(console,Array.prototype.slice.call(arguments))}}}var te=function(t){return t[t.OnAuthError=0]="OnAuthError",t[t.OnAuthLogout=1]="OnAuthLogout",t[t.OnAuthRefreshError=2]="OnAuthRefreshError",t[t.OnAuthRefreshSuccess=3]="OnAuthRefreshSuccess",t[t.OnAuthSuccess=4]="OnAuthSuccess",t[t.OnReady=5]="OnReady",t[t.OnTokenExpired=6]="OnTokenExpired",t[t.OnActionUpdate=7]="OnActionUpdate",t}(te||{});var be=(()=>{class t{constructor(){this._keycloakEvents$=new je}bindsKeycloakEvents(){this._instance.onAuthError=r=>{this._keycloakEvents$.next({args:r,type:te.OnAuthError})},this._instance.onAuthLogout=()=>{this._keycloakEvents$.next({type:te.OnAuthLogout})},this._instance.onAuthRefreshSuccess=()=>{this._keycloakEvents$.next({type:te.OnAuthRefreshSuccess})},this._instance.onAuthRefreshError=()=>{this._keycloakEvents$.next({type:te.OnAuthRefreshError})},this._instance.onAuthSuccess=()=>{this._keycloakEvents$.next({type:te.OnAuthSuccess})},this._instance.onTokenExpired=()=>{this._keycloakEvents$.next({type:te.OnTokenExpired})},this._instance.onActionUpdate=r=>{this._keycloakEvents$.next({args:r,type:te.OnActionUpdate})},this._instance.onReady=r=>{this._keycloakEvents$.next({args:r,type:te.OnReady})}}loadExcludedUrls(r){let n=[];for(let i of r){let a;typeof i=="string"?a={urlPattern:new RegExp(i,"i"),httpMethods:[]}:a={urlPattern:new RegExp(i.url,"i"),httpMethods:i.httpMethods},n.push(a)}return n}initServiceValues({enableBearerInterceptor:r=!0,loadUserProfileAtStartUp:n=!1,bearerExcludedUrls:i=[],authorizationHeaderName:a="Authorization",bearerPrefix:c="Bearer",initOptions:v,updateMinValidity:u=20,shouldAddToken:_=()=>!0,shouldUpdateToken:S=()=>!0}){this._enableBearerInterceptor=r,this._loadUserProfileAtStartUp=n,this._authorizationHeaderName=a,this._bearerPrefix=c.trim().concat(" "),this._excludedUrls=this.loadExcludedUrls(i),this._silentRefresh=v?v.flow==="implicit":!1,this._updateMinValidity=u,this.shouldAddToken=_,this.shouldUpdateToken=S}init(){return ee(this,arguments,function*(r={}){this.initServiceValues(r);let{config:n,initOptions:i}=r;this._instance=new Oe(n),this.bindsKeycloakEvents();let a=yield this._instance.init(i);return a&&this._loadUserProfileAtStartUp&&(yield this.loadUserProfile()),a})}login(){return ee(this,arguments,function*(r={}){yield this._instance.login(r),this._loadUserProfileAtStartUp&&(yield this.loadUserProfile())})}logout(r){return ee(this,null,function*(){let n={redirectUri:r};yield this._instance.logout(n),this._userProfile=void 0})}register(){return ee(this,arguments,function*(r={action:"register"}){yield this._instance.register(r)})}isUserInRole(r,n){let i;return i=this._instance.hasResourceRole(r,n),i||(i=this._instance.hasRealmRole(r)),i}getUserRoles(r=!0,n){let i=[];if(this._instance.resourceAccess&&Object.keys(this._instance.resourceAccess).forEach(a=>{if(n&&n!==a)return;let v=this._instance.resourceAccess[a].roles||[];i=i.concat(v)}),r&&this._instance.realmAccess){let a=this._instance.realmAccess.roles||[];i.push(...a)}return i}isLoggedIn(){return this._instance?this._instance.authenticated:!1}isTokenExpired(r=0){return this._instance.isTokenExpired(r)}updateToken(){return ee(this,arguments,function*(r=this._updateMinValidity){if(this._silentRefresh){if(this.isTokenExpired())throw new Error("Failed to refresh the token, or the session is expired");return!0}if(!this._instance)throw new Error("Keycloak Angular library is not initialized.");try{return yield this._instance.updateToken(r)}catch{return!1}})}loadUserProfile(r=!1){return ee(this,null,function*(){if(this._userProfile&&!r)return this._userProfile;if(!this._instance.authenticated)throw new Error("The user profile was not loaded as the user is not logged in.");return this._userProfile=yield this._instance.loadUserProfile()})}getToken(){return ee(this,null,function*(){return this._instance.token})}getUsername(){if(!this._userProfile)throw new Error("User not logged in or user profile was not loaded.");return this._userProfile.username}clearToken(){this._instance.clearToken()}addTokenToHeader(r=new Je){return ue(this.getToken()).pipe(pe(n=>n?r.set(this._authorizationHeaderName,this._bearerPrefix+n):r))}getKeycloakInstance(){return this._instance}get excludedUrls(){return this._excludedUrls}get enableBearerInterceptor(){return this._enableBearerInterceptor}get keycloakEvents$(){return this._keycloakEvents$}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275prov=xe({token:t,factory:t.\u0275fac})}}return t})(),Yr=(()=>{class t{constructor(r){this.keycloak=r}conditionallyUpdateToken(r){return ee(this,null,function*(){return this.keycloak.shouldUpdateToken(r)?yield this.keycloak.updateToken():!0})}isUrlExcluded({method:r,url:n},{urlPattern:i,httpMethods:a}){let c=a.length===0||a.join().indexOf(r.toUpperCase())>-1,v=i.test(n);return c&&v}intercept(r,n){let{enableBearerInterceptor:i,excludedUrls:a}=this.keycloak;return!i||!this.keycloak.shouldAddToken(r)||a.findIndex(v=>this.isUrlExcluded(r,v))>-1?n.handle(r):Ke([ue(this.conditionallyUpdateToken(r)),we(this.keycloak.isLoggedIn())]).pipe(Ue(([v,u])=>u?this.handleRequestWithTokenHeader(r,n):n.handle(r)))}handleRequestWithTokenHeader(r,n){return this.keycloak.addTokenToHeader(r.headers).pipe(Ue(i=>{let a=r.clone({headers:i});return n.handle(a)}))}static{this.\u0275fac=function(n){return new(n||t)(ye(be))}}static{this.\u0275prov=xe({token:t,factory:t.\u0275fac})}}return t})(),Wr=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=Se({type:t})}static{this.\u0275inj=Ee({providers:[be,{provide:$e,useClass:Yr,multi:!0}],imports:[ze]})}}return t})(),ft=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=Se({type:t})}static{this.\u0275inj=Ee({imports:[Wr]})}}return t})();var dr=class t{constructor(e){this.keycloak=e}profile;authenticated=!1;init(){return ue(Promise.resolve(this.keycloak.isLoggedIn())).pipe(pe(e=>(this.authenticated=e,e?this.syncProfileFromToken():void 0)))}login(){this.keycloak.login({redirectUri:window.location.origin+"/catalog"})}logout(){this.keycloak.logout(window.location.origin)}isAuthenticated(){return this.authenticated}getToken(){return this.keycloak.getToken()}getProfile(){return this.profile}getCurrentUser(){return ue(this.keycloak.loadUserProfile()).pipe(pe(e=>this.mapAccountUser(e)),Ve(()=>we(this.mapFallbackAccountUser())))}hasRole(e){return this.keycloak.isUserInRole(e)}hasAnyRole(e){return e.some(r=>this.hasRole(r))}getRoles(){let e=this.keycloak.getKeycloakInstance().tokenParsed??{},r=e.realm_access?.roles??[],n=e.resource_access??{},i=Object.values(n).flatMap(a=>a.roles??[]);return Array.from(new Set([...r,...i]))}getAccountManagementUrl(e="/profile"){return this.keycloak.getKeycloakInstance().createAccountUrl({redirectUri:`${window.location.origin}${e}`})}getKeycloakAccountUrl(){return`${this.getRealmBaseUrl()}/account`}getKeycloakPasswordChangeUrl(){return`${this.getKeycloakAccountUrl()}/password`}syncProfileFromToken(){let e=this.keycloak.getKeycloakInstance().tokenParsed??void 0;if(!e){this.profile=void 0;return}let r={firstName:e.given_name,lastName:e.family_name,email:e.email,username:e.preferred_username??void 0};return this.profile=r,r}mapAccountUser(e){let r=`${e.firstName??""} ${e.lastName??""}`.trim()||e.username||"Portfolio User",n=this.keycloak.getKeycloakInstance().tokenParsed,i=typeof n?.auth_time=="number"?new Date(n.auth_time*1e3):void 0,a=e.attributes??void 0,c=a?.phone??a?.phoneNumber,v=Array.isArray(c)&&c.length>0?c[0]:void 0;return{id:e.id??e.username??"current-user",name:r,email:e.email??"sin-email@portfolio.local",username:e.username??"portfolio-user",phone:v,avatar:void 0,roles:this.getRoles(),passwordUpdatedAt:i,twoFactorEnabled:!1}}getRealmBaseUrl(){return`${_e.keycloak.url.replace(/\/$/,"")}/realms/${_e.keycloak.realm}`}mapFallbackAccountUser(){let e=this.syncProfileFromToken();if(e)return this.mapAccountUser(e);let r="portfolio-user";return{id:r,name:"Portfolio User",email:"sin-email@portfolio.local",username:r,phone:void 0,avatar:void 0,roles:this.getRoles(),passwordUpdatedAt:void 0,twoFactorEnabled:!1}}static \u0275fac=function(r){return new(r||t)(ye(be))};static \u0275prov=xe({token:t,factory:t.\u0275fac,providedIn:"root"})};export{be as a,ft as b,dr as c};
