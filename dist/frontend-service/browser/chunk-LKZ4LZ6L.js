import{a as J}from"./chunk-LAMJ2ZX6.js";import{a as H}from"./chunk-4YL2GGIB.js";import{a as G}from"./chunk-5545PIR5.js";import{c as U}from"./chunk-RAB63YMJ.js";import"./chunk-TO4NHBEA.js";import{a as ie}from"./chunk-4DONFFHM.js";import"./chunk-HBN5ZDUM.js";import{$ as p,$a as w,A as k,Aa as B,Ac as ne,B as x,Ba as q,D as y,E as v,M as c,N as d,Nb as X,P as u,R as s,Rb as Y,Sa as L,U as r,Ua as Q,V as n,W as _,X as h,Y as P,Ya as K,Z as I,Za as W,_ as M,da as T,ea as o,fa as g,g as N,ga as E,kc as Z,na as f,oa as z,pa as O,qa as R,ra as F,v as j,va as $,wa as A,xa as D,xc as ee,y as C,za as V,zc as te}from"./chunk-XZKYCDIA.js";function ce(i,t){if(i&1){let e=I();r(0,"mat-card",14)(1,"div",15)(2,"div")(3,"p",16),o(4),f(5,"slice"),n(),r(6,"h3"),o(7),n()(),r(8,"button",17),M("click",function(){let m=y(e).$implicit,l=p(3);return v(l.remove(m.productId))}),_(9,"lucide-icon",18),n()(),r(10,"div",19)(11,"div",20)(12,"span"),o(13,"Precio"),n(),r(14,"strong"),o(15),f(16,"currency"),n()(),r(17,"mat-form-field",21)(18,"mat-label"),o(19,"Cantidad"),n(),r(20,"input",22),M("input",function(m){let l=y(e).$implicit,ae=p(3);return v(ae.updateQuantity(l.productId,m.target.value))}),n()(),r(21,"div",23)(22,"span"),o(23,"Total"),n(),r(24,"strong"),o(25),f(26,"currency"),n()()()()}if(i&2){let e=t.$implicit;c(4),E("#",R(5,5,e.productId,0,8),""),c(3),g(e.productName),c(8),g(O(16,9,e.price,e.currency)),c(5),s("value",e.quantity),c(5),g(O(26,12,e.price*e.quantity,e.currency))}}function me(i,t){if(i&1&&(r(0,"small"),o(1," El pedido se asociar\xE1 a "),r(2,"strong"),o(3),n(),o(4),n()),i&2){let e=p(3);c(3),g(e.user.name),c(),E(" (",e.user.email,"). ")}}function pe(i,t){if(i&1){let e=I();h(0),r(1,"div",6),u(2,ce,27,15,"mat-card",7),n(),r(3,"mat-card",8)(4,"div",9)(5,"div")(6,"p",10),o(7,"Importe total"),n(),r(8,"p",11),o(9),f(10,"currency"),n()(),r(11,"button",12),M("click",function(){y(e);let m=p().ngIf,l=p();return v(l.checkout(m))}),_(12,"lucide-icon",13),o(13," Proceder al pago "),n()(),u(14,me,5,2,"small",4),n(),P()}if(i&2){let e=p().ngIf,a=p();c(2),s("ngForOf",e),c(7),g(O(10,4,a.getTotal(e),a.getCurrency(e))),c(2),s("disabled",a.isSubmitting),c(3),s("ngIf",a.user)}}function se(i,t){if(i&1&&(h(0),u(1,pe,15,7,"ng-container",5),P()),i&2){let e=t.ngIf;p();let a=T(12);c(),s("ngIf",e.length)("ngIfElse",a)}}function le(i,t){i&1&&(r(0,"div",24),_(1,"lucide-icon",25),r(2,"p"),o(3,"Tu carrito est\xE1 vac\xEDo."),n(),r(4,"a",26),_(5,"lucide-icon",27),o(6," Explorar cat\xE1logo "),n()())}var S=class i{constructor(t,e,a,m,l){this.cartService=t;this.ordersService=e;this.notificationService=a;this.authService=m;this.router=l}user;isSubmitting=!1;destroy$=new N;get items$(){return this.cartService.items$}ngOnInit(){this.authService.getCurrentUser().pipe(j(this.destroy$)).subscribe(t=>this.user=t)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}remove(t){this.cartService.remove(t)}updateQuantity(t,e){!Number.isFinite(e)||e<1||this.cartService.updateQuantity(t,Math.floor(e))}checkout(t){if(!t.length||this.isSubmitting)return;if(!this.user){this.notificationService.error("No se pudo identificar al usuario actual.");return}let e=this.getCurrency(t),a={userId:this.user.id,currency:e,items:t.map(m=>({productId:m.productId,quantity:m.quantity}))};this.isSubmitting=!0,this.ordersService.createOrder(a).subscribe({next:m=>{this.notificationService.success("Pedido creado correctamente."),this.cartService.clear(),this.isSubmitting=!1,this.router.navigate(["/orders",m.id])},error:()=>{this.isSubmitting=!1,this.notificationService.error("No se pudo procesar el pago. Int\xE9ntalo nuevamente.")}})}getTotal(t){return t.reduce((e,a)=>e+a.price*a.quantity,0)}getCurrency(t){return t[0]?.currency??"USD"}static \u0275fac=function(e){return new(e||i)(d(J),d(H),d(G),d(U),d(K))};static \u0275cmp=k({type:i,selectors:[["app-cart"]],decls:13,vars:3,consts:[["emptyCart",""],[1,"cart-container"],[1,"page-header"],[1,"eyebrow"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"items-grid"],["class","cart-item",4,"ngFor","ngForOf"],[1,"summary-card"],[1,"summary-row"],[1,"summary-label"],[1,"summary-value"],["mat-raised-button","","color","primary","type","button",3,"click","disabled"],["name","CreditCard","size","18"],[1,"cart-item"],[1,"item-head"],[1,"sku"],["mat-icon-button","","type","button","aria-label","Eliminar",3,"click"],["name","Trash2","size","18"],[1,"item-body"],[1,"price-box"],["appearance","outline",1,"quantity-field"],["matInput","","type","number","min","1",3,"input","value"],[1,"price-box","total"],[1,"empty-cart"],["name","ShoppingCart","size","48"],["routerLink","/catalog",1,"btn","btn-primary"],["name","ArrowRight","size","16"]],template:function(e,a){e&1&&(r(0,"section",1)(1,"div",2)(2,"div")(3,"p",3),o(4,"Checkout"),n(),r(5,"h2"),o(6,"Carrito de compras"),n(),r(7,"p"),o(8,"Revisa tus productos y confirma el pedido cuando est\xE9s listo."),n()()(),u(9,se,2,2,"ng-container",4),f(10,"async"),u(11,le,7,0,"ng-template",null,0,F),n()),e&2&&(c(9),s("ngIf",z(10,1,a.items$)))},dependencies:[$,A,L,Q,Y,te,ee,ne,X,W,D,B,V],styles:[".cart-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;padding:24px}.cart-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.cart-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .eyebrow[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:.2em;font-size:.75rem;color:#6b7280;margin-bottom:4px}.cart-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:clamp(28px,4vw,36px)}.cart-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#4b5563;margin:4px 0 0}.items-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:16px}.cart-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.cart-item[_ngcontent-%COMP%]   .item-head[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.cart-item[_ngcontent-%COMP%]   .item-head[_ngcontent-%COMP%]   .sku[_ngcontent-%COMP%]{text-transform:uppercase;font-size:.75rem;letter-spacing:.1em;color:#9ca3af;margin:0 0 4px}.cart-item[_ngcontent-%COMP%]   .item-head[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.cart-item[_ngcontent-%COMP%]   .item-body[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:flex-end;flex-wrap:wrap}.cart-item[_ngcontent-%COMP%]   .price-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.cart-item[_ngcontent-%COMP%]   .price-box[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.8rem;color:#6b7280}.cart-item[_ngcontent-%COMP%]   .price-box[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.2rem}.cart-item[_ngcontent-%COMP%]   .price-box.total[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#1d4ed8}.cart-item[_ngcontent-%COMP%]   .quantity-field[_ngcontent-%COMP%]{width:120px}.summary-card[_ngcontent-%COMP%]{padding:24px;display:flex;flex-direction:column;gap:8px}.summary-card[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px}.summary-card[_ngcontent-%COMP%]   .summary-label[_ngcontent-%COMP%]{margin:0;text-transform:uppercase;letter-spacing:.2em;font-size:.75rem;color:#6b7280}.summary-card[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{margin:0;font-size:2rem}.empty-cart[_ngcontent-%COMP%]{min-height:320px;padding:48px;border:1px dashed #d1d5db;border-radius:20px;display:flex;flex-direction:column;gap:16px;align-items:center;justify-content:center;color:#6b7280}.empty-cart[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1.1rem}.empty-cart[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px}"]})};var de=[{path:"",component:S}],b=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=x({type:i});static \u0275inj=C({imports:[w.forChild(de),w]})};var oe=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=x({type:i});static \u0275inj=C({imports:[q,Z,ie,b]})};export{oe as CartModule};
