<section class="orders-container">
  <div class="page-header">
    <div class="page-info">
      <p class="eyebrow">
        {{
          isAdmin
            ? ('orders.eyebrow.admin' | translate)
            : ('orders.eyebrow.user' | translate)
        }}
      </p>
      <h2>
        {{
          isAdmin
            ? ('orders.title.admin' | translate)
            : ('orders.title.user' | translate)
        }}
      </h2>
      <p>
        {{
          isAdmin
            ? ('orders.description.admin' | translate)
            : ('orders.description.user' | translate)
        }}
      </p>
    </div>
    <a class="btn btn-primary" routerLink="create" *ngIf="isAdmin">
      <lucide-icon name="Plus" size="18"></lucide-icon>
      {{ 'orders.button.new' | translate }}
    </a>
    <a class="btn btn-secondary" routerLink="/cart" *ngIf="!isAdmin">
      <lucide-icon name="ShoppingCart" size="18"></lucide-icon>
      {{ 'orders.button.cart' | translate }}
    </a>
  </div>

  <div class="filters-bar">
    <div class="search-box">
      <lucide-icon name="Search" size="16"></lucide-icon>
      <input
        type="search"
        [placeholder]="'orders.search.placeholder' | translate"
        [value]="searchQuery"
        (input)="handleSearch($any($event.target).value)"
      />
      <button class="btn-icon" *ngIf="searchQuery" (click)="clearSearch()" type="button">
        <lucide-icon name="X" size="14"></lucide-icon>
      </button>
    </div>
    <select
      class="filter-select"
      [value]="statusFilter"
      (change)="onStatusChange($any($event.target).value)"
    >
      <option value="">{{ 'orders.status.all' | translate }}</option>
      <option value="PENDING">{{ 'orders.status.pending' | translate }}</option>
      <option value="CONFIRMED">{{ 'orders.status.confirmed' | translate }}</option>
      <option value="SHIPPED">{{ 'orders.status.shipped' | translate }}</option>
      <option value="DELIVERED">{{ 'orders.status.delivered' | translate }}</option>
      <option value="CANCELLED">{{ 'orders.status.cancelled' | translate }}</option>
    </select>
  </div>

  <div class="bulk-actions" *ngIf="isAdmin && selectedOrders.size">
    <span>
      {{ selectedOrders.size }}
      {{ 'orders.bulk.selectionLabel' | translate }}
    </span>
    <button class="btn btn-text" type="button" (click)="bulkClear()">
      {{ 'orders.bulk.clean' | translate }}
    </button>
  </div>

  <div class="table-container">
    <table class="orders-table">
      <thead>
        <tr>
          <th *ngIf="isAdmin">
            <input
              type="checkbox"
              [checked]="selectedOrders.size === filteredOrders.length"
              (change)="toggleSelectAll()"
            />
          </th>
          <th>{{ 'orders.table.user' | translate }}</th>
          <th>{{ 'orders.table.status' | translate }}</th>
          <th>{{ 'orders.table.total' | translate }}</th>
          <th>{{ 'orders.table.created' | translate }}</th>
          <th>{{ 'orders.table.actions' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of filteredOrders" [class.selected]="isSelected(order.id)">
          <td *ngIf="isAdmin">
            <input type="checkbox" [checked]="isSelected(order.id)" (change)="toggleSelect(order.id)" />
          </td>
          <td>
            <div class="user-info">
              <strong>
                {{ order.userName || ('order.detail.userFallback' | translate) }}
              </strong>
              <small>
                {{
                  order.userEmail || ('orders.table.userEmailFallback' | translate)
                }}
              </small>
            </div>
          </td>
          <td>
            <span class="status-chip" [ngClass]="order.status.toLowerCase()">{{ order.status }}</span>
          </td>
          <td>{{ order.totalAmount | currency: order.currency }}</td>
          <td>{{ order.createdAt | date: 'short' }}</td>
          <td>
            <a class="btn btn-text" [routerLink]="[order.id]">
              {{ 'orders.table.view' | translate }}
              <lucide-icon name="ArrowRight" size="14"></lucide-icon>
            </a>
          </td>
        </tr>
        <tr *ngIf="!filteredOrders.length">
          <td [attr.colspan]="isAdmin ? 6 : 5" class="empty-message">
            {{ 'orders.empty' | translate }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

