<ng-container *ngIf="user$ | async as user">
  <section class="user-detail">
    <div class="user-detail__toolbar">
      <app-back-button fallbackUrl="/users"></app-back-button>
    </div>

    <div class="user-detail__header">
      <div>
        <p class="eyebrow">{{ 'users.detail.eyebrow' | translate }}</p>
        <h1>{{ displayName(user) }}</h1>
        <p class="muted">{{ user.email }}</p>
      </div>
      <span class="status-chip" [class.inactive]="!user.active">
        {{
          user.active
            ? ('users.detail.status.active' | translate)
            : ('users.detail.status.inactive' | translate)
        }}
      </span>
    </div>

    <div class="user-detail__grid">
      <article class="detail-card">
        <p class="detail-card__label">{{ 'users.detail.contact' | translate }}</p>
        <dl>
          <div>
            <dt>{{ 'profile.personal.phone' | translate }}</dt>
            <dd>{{ user.phone || ('profile.personal.unset' | translate) }}</dd>
          </div>
          <div>
            <dt>{{ 'users.detail.created' | translate }}</dt>
            <dd>{{ user.createdAt | date: 'medium' }}</dd>
          </div>
          <div>
            <dt>{{ 'profile.personal.fullName' | translate }}</dt>
            <dd>{{ user.fullName || displayName(user) }}</dd>
          </div>
        </dl>
      </article>

      <article class="detail-card">
        <p class="detail-card__label">{{ 'users.detail.roles' | translate }}</p>
        <div class="roles-list" *ngIf="editableRoles.length; else emptyRoles">
          <span class="role-chip" *ngFor="let role of editableRoles">
            {{ role }}
            <button
              type="button"
              class="role-remove"
              (click)="removeRole(role)"
              [attr.aria-label]="'users.detail.roles.remove' | translate"
            >
              <lucide-icon name="X" size="12"></lucide-icon>
            </button>
          </span>
        </div>
        <div class="roles-editor">
          <div class="roles-editor__input">
            <input
              type="text"
              [(ngModel)]="newRole"
              [placeholder]="'users.detail.roles.addPlaceholder' | translate"
              (keyup.enter)="addRole()"
            />
            <button class="btn btn-secondary" type="button" (click)="addRole()">
              {{ 'users.detail.roles.addButton' | translate }}
            </button>
          </div>
          <small class="muted">{{ 'users.detail.roles.helper' | translate }}</small>
          <div class="roles-editor__actions">
            <button
              class="btn btn-text"
              type="button"
              (click)="resetRoles()"
              [disabled]="savingRoles || !rolesChanged"
            >
              {{ 'users.detail.roles.reset' | translate }}
            </button>
            <button
              class="btn btn-primary"
              type="button"
              (click)="saveRoles()"
              [disabled]="savingRoles || !rolesChanged"
            >
              {{
                savingRoles
                  ? ('users.detail.roles.saving' | translate)
                  : ('users.detail.roles.save' | translate)
              }}
            </button>
          </div>
        </div>
        <ng-template #emptyRoles>
          <p class="muted">{{ 'users.detail.roles.empty' | translate }}</p>
        </ng-template>
      </article>

      <article class="detail-card">
        <p class="detail-card__label">{{ 'users.detail.keycloak' | translate }}</p>
        <dl>
          <div>
            <dt>{{ 'users.detail.realm' | translate }}</dt>
            <dd>portfolio-realm</dd>
          </div>
          <div>
            <dt>{{ 'orders.table.status' | translate }}</dt>
            <dd>
              {{
                user.active
                  ? ('users.detail.status.active' | translate)
                  : ('users.detail.status.inactive' | translate)
              }}
            </dd>
          </div>
        </dl>
      </article>
    </div>
  </section>
</ng-container>
